package com.healthcare.stepdefinitions;

import com.healthcare.pages.ServicesPage;
import com.healthcare.utils.ConfigReader;
import com.healthcare.utils.DriverFactory;
import io.cucumber.java.en.*;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

import java.util.List;

public class ServicesSteps {
    private WebDriver driver = DriverFactory.getDriver();
    private ServicesPage servicesPage = new ServicesPage();

    @Given("user is on the home page")
    public void user_is_on_the_home_page() {
        driver.get(ConfigReader.getProperty("baseUrl"));
    }

    @When("user clicks on the Services menu")
    public void user_clicks_on_the_services_menu() {
        servicesPage.openServicesDropdown();
    }

    @Then("user should see the list of services and visit each one")
    public void user_should_see_the_list_of_services_and_visit_each_one() throws InterruptedException {
        List<WebElement> services = servicesPage.getAllServiceLinks();

        for (int i = 0; i < services.size(); i++) {
            // Hover again before each click (dropdown may disappear)
            servicesPage.openServicesDropdown();
            services = servicesPage.getAllServiceLinks();

            WebElement service = services.get(i);
            String serviceName = service.getText();
            System.out.println("Clicking service: " + serviceName);

            service.click();
            Thread.sleep(2000);

            System.out.println("Navigated to: " + driver.getCurrentUrl());

            // return home
            driver.get(ConfigReader.getProperty("baseUrl"));
            Thread.sleep(2000);
        }
    }

    @And("user closes the browser after navigating")
    public void user_closes_the_browser_after_navigating() throws InterruptedException {
        Thread.sleep(2000);
        driver.quit();
    }
}
