package com.healthcare.tests;

import com.healthcare.pages.HealthyAgingFormPage;
import com.healthcare.utils.ConfigReader;
import com.healthcare.utils.DriverFactory;
import org.openqa.selenium.WebDriver;
import org.testng.Assert;
import org.testng.annotations.*;

import java.util.concurrent.TimeUnit;

public class HealthyAgingFormTests {
    private WebDriver driver;
    private HealthyAgingFormPage formPage;

    @BeforeClass
    public void beforeClass() {
        // Load config file once
        ConfigReader.loadConfig();
    }

    @BeforeMethod
    public void setUp() {
        // Initialize browser
        DriverFactory.initDriver(ConfigReader.get("browser"));
        driver = DriverFactory.getDriver();

        // Apply implicit wait globally
        driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);

        // Navigate using config value
        driver.get(ConfigReader.get("healthyAgingUrl"));

        // Initialize Page Object
        formPage = new HealthyAgingFormPage();
    }

    @Test
    public void testFormSubmission() throws InterruptedException {
        formPage.enterName("John", "Doe");
        formPage.enterContact("1234567890", "john.doe@example.com");
        formPage.selectPrograms();
        formPage.selectCounty();
        formPage.selectClassFormat();
        formPage.selectDescription("Student");
        formPage.enterHowHeard("Through a friend");
        formPage.checkNotify();
        formPage.submitForm();

        // Assertion â€“ verify "thank you" message
        Assert.assertTrue(
                driver.getPageSource().toLowerCase().contains("thank you"),
                "Form submission did not succeed!"
        );

        System.out.println("Healthy Aging form submitted successfully!");
    }

    @AfterMethod
    public void tearDown() {
        if (driver != null) {
            driver.quit();
        }
    }
}
